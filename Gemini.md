# Project Analysis: AgSalesAnalitics

## 1. Executive Summary
**AgSalesAnalitics** is a modern, full-stack web application designed for visualizing and analyzing sales data. 
It features a **Vite + React** frontend for a responsive user interface and a **Node.js + Express** backend that connects to a local **Microsoft SQL Server (MSSQL)** database.
The application currently includes AI-powered summarization capabilities using OpenAI and DeepSeek models.

## 2. Technology Stack

### Frontend
- **Framework:** React 18 (via Vite)
- **Visualization:** Recharts (for sales charts/graphs)
- **Icons:** Lucide-React
- **Animations:** Framer Motion
- **Language:** JavaScript (ES Modules)

### Backend (`/server`)
- **Runtime:** Node.js
- **Framework:** Express.js
- **Database Driver:** `mssql` (Microsoft SQL Server)
- **AI Client:** `openai` (Official Node.js library)
- **Environment Management:** `dotenv`

## 3. Current Architecture

### Data Flow
1.  **Frontend** requests data from the Backend API (e.g., `/api/connect`, `/api/analyze`).
2.  **Backend** connects to the MSSQL database using credentials provided in the request or environment.
3.  **Backend** executes SQL queries (currently fetching `TOP 100` rows for analysis).
4.  **Backend** sends a sample of this data (first 50 rows) to an LLM (Large Language Model) to generate a textual summary.
5.  **Frontend** receives both the raw data (for charts) and the AI summary (for insights) to display to the user.

### Current AI Implementation
The backend currently supports two AI providers via the `openai` SDK:
-   **DeepSeek:** Enabled if `DEEPSEEK_API_KEY` is present. Uses `deepseek-reasoner` model via `https://api.deepseek.com`.
-   **OpenAI:** Fallback if `OPENAI_API_KEY` is present. Uses `gpt-4o` (or similar).

## 4. Proposed Gemini Integration
To enhance the application with Google's Gemini models (which often offer larger context windows and lower latency for this type of task), we can integrate the **Google Generative AI SDK**.

### Recommended Changes

1.  **Install Dependency:**
    ```bash
    cd server
    npm install @google/generative-ai
    ```

2.  **Update `server/index.js`:**
    Modify the `getLLMClient` (or equivalent logic) to check for a `GEMINI_API_KEY`.

    ```javascript
    // Import Google GenAI
    const { GoogleGenerativeAI } = require("@google/generative-ai");

    // Inside getLLMClient or a new handler
    if (process.env.GEMINI_API_KEY) {
        const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        
        // ... generation logic using model.generateContent()
    }
    ```

3.  **Environment Variable:**
    Add `GEMINI_API_KEY` to `server/.env`.

### Benefits of Gemini Integration
-   **Cost/Performance:** Gemini 1.5 Flash is extremely fast and cost-effective for summarization tasks.
-   **Context Window:** Gemini's massive context window allows sending *all* retrieved rows (not just the first 50) for a more accurate comprehensive summary.

## 5. Code Quality & Security Analysis

### Security
-   **SQL Injection:** The current implementation of `SELECT TOP 100 * FROM ${table}` in `server/index.js` is vulnerable to SQL injection. While acceptable for a local prototype, it must be parameterized or validated against a schema for production.
-   **API Keys:** Keys are correctly managed via `dotenv`, preventing accidental commit to version control (assuming `.env` is git-ignored).

### Best Practices
-   **Frontend:** The React structure simulates a clean component hierarchy. State management is simple (prop drilling), which is appropriate for this scale.
-   **Backend:** Routes are clear. The AI integration logic is modularized in `getLLMClient`.

## 6. Next Steps
1.  [ ] Install `@google/generative-ai` in the server directory.
2.  [ ] Refactor `server/index.js` to support the Gemini client alongside OpenAI/DeepSeek.
3.  [ ] Update the frontend to potentially allow switching between models (optional).
4.  [ ] Add error handling specific to Google's API.

---
*Analysis generated by Antigravity*
